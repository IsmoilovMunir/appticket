# Инструкции по безопасности

## ⚠️ ВАЖНО: Настройка безопасности перед запуском в продакшене

### 1. Установка пароля администратора

**Обязательно** задайте переменную окружения `ADMIN_DEFAULT_PASSWORD` перед первым запуском:

```bash
export ADMIN_DEFAULT_PASSWORD="ваш_надежный_пароль_минимум_12_символов"
```

Или в `docker-compose.yml`:
```yaml
environment:
  - ADMIN_DEFAULT_PASSWORD=ваш_надежный_пароль
```

**Без этой переменной дефолтный админ не будет создан!**

### 2. JWT Secret Key

Измените `JWT_SECRET` в `application.yml` или через переменную окружения:

```bash
export JWT_SECRET="ваш_случайный_секретный_ключ_минимум_64_символа"
```

### 3. Закрытие Swagger в продакшене

В `SecurityConfig.java` закомментируйте или удалите строки:
```java
.requestMatchers("/v3/api-docs/**", "/swagger-ui/**").permitAll()
```

### 4. База данных

Измените дефолтные пароли в `application.yml`:
- `DB_PASSWORD` - пароль PostgreSQL
- `REDIS_PASSWORD` - пароль Redis (если используется)

### 5. Защита от brute force

Система автоматически блокирует IP после 5 неудачных попыток входа на 15 минут.

### 6. JWT токены

- TTL токенов: 30 минут (1800 секунд)
- Настраивается через `JWT_TTL_SECONDS`

### 7. Рекомендации

1. **Никогда не коммитьте** пароли в git
2. Используйте `.env` файлы для локальной разработки
3. В продакшене используйте секреты (Kubernetes Secrets, AWS Secrets Manager и т.д.)
4. Регулярно меняйте пароли администраторов
5. Используйте HTTPS в продакшене
6. Настройте firewall для ограничения доступа к админским эндпоинтам

### 8. Смена пароля

После первого входа в админку **обязательно смените пароль**:

1. Войдите в админку (`/admin`)
2. Найдите секцию "Смена пароля" (желтая карточка вверху)
3. Введите текущий пароль и новый надежный пароль (минимум 8 символов)
4. Нажмите "Изменить пароль"

**Важно:** Если вы видите предупреждение браузера о том, что пароль был раскрыт в утечке данных, это означает, что ваш текущий пароль находится в базе известных утечек. Немедленно смените его на уникальный надежный пароль!

### 9. Проверка безопасности

После настройки проверьте:
- ✅ Все админские эндпоинты требуют аутентификации
- ✅ Rate limiting работает
- ✅ Пароли не хардкодятся в коде
- ✅ JWT secret изменен
- ✅ Swagger закрыт в продакшене
- ✅ Пароль администратора изменен после первого входа

